BACI System: BenAri Pascal PCODE Compiler, 12:29  18 Jul 2004
Source file: C:\Users\bu0532\jbaci\examples\p-c-mon.pm  Mon Jun 17 13:53:46 2024
 line  pc
   1    0  monitor PC;
   2    0  const	N = 5;
   3    0  var	Oldest: integer;
   4    0  	Newest:	integer;
   5    0  	Count:  integer;
   6    0  	NotEmpty: Condition;
   7    0  	NotFull: Condition;
   8    0  	Buffer:	array[0..N] of integer;
   9    0  
  10    0  procedure Append(V: integer);
  11    0  begin
  12    1  	if Count = N then
  13    5  		WaitC(NotFull);
  14    8  	Buffer[Newest] := V;
  15   13  	Newest := (Newest + 1) mod N;
  16   20  	Count := Count + 1;
  17   25  	SignalC(NotEmpty);
  18   27  end;
  19   29  
  20   29  procedure Take(var V: Integer);
  21   29  begin
  22   30  	if Count = 0 then
  23   34  		WaitC(NotEmpty);
  24   37  	V := Buffer[Oldest];
  25   43  	Oldest := (Oldest + 1) mod N;
  26   50  	Count := Count - 1;
  27   55  	SignalC(NotFull);
  28   57  end;
  29   59  
  30   59  begin
  31   59  	Count := 0; Oldest := 0; Newest := 0;
  32   68  end;
  33   69  
  34   69  program ProducerConsumer;
  35   69  
  36   69  const	Values = 20;
  37   69  
  38   69  procedure Producer(ID: integer);
  39   69  var	I: integer;
  40   69  begin
  41   69  	for I := 1 to Values do
  42   73  		begin
  43   73  		writeln("Producer ", ID, " producing ", ID*100+I);
  44   84  		Append(ID*100+I);
  45   92  		end;
  46   93  end;
  47   94  
  48   94  procedure Consumer(ID: integer);
  49   94  var	I, J: integer;
  50   94  begin
  51   94  	for I := 1 to Values do
  52   98  		begin
  53   98  		Take(J);
  54  102  		writeln("Consumer ", ID, " consuming ", J);
  55  109  		end;
  56  110  end;
  57  111  
  58  111  begin
  59  112  	cobegin
  60  113  		Producer(1); Consumer(1); Producer(2); Consumer(2);
  61  125  	coend;
  62  126  end.
  63  130  
